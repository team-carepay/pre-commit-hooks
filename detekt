#!/usr/bin/env bash

BASEDIR="$(dirname "$0")"
if [[ ! -f "$BASEDIR/detekt.jar" ]]; then
  curl -sL -o "$BASEDIR/detekt.jar" $(curl -s https://api.github.com/repos/detekt/detekt/releases/latest | jq -r '.assets[].browser_download_url')
fi

while getopts ":c:" opt; do
  case $opt in
    c) config="$OPTARG"
    set -- "$@" "$opt"
    ;;
  esac
done

shift $#

if [[ $config == http://* ]] | [[ $config == https://* ]]
then
  curl -sL -o "$BASEDIR/detekt.yml" $config
fi

java --add-opens java.base/java.util=ALL-UNNAMED -jar "$BASEDIR/detekt.jar" -c "$BASEDIR/detekt.yml" "$@"
